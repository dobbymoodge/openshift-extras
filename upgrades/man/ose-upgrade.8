.\" Text automatically generated by txt2man
.TH ose-upgrade  "26 November 2013" "" ""
.SH NAME
\fB
\fBose-upgrade
\fB
.SH SYNOPSIS
.nf
.fam C

\fBose-upgrade\fP [status|all|<step> [<step>\.\.\.]]
  [\fB-s\fP|\fB--skip\fP] [\fB-q\fP|\fB--quiet\fP] [\fB-d\fP|\fB--debug\fP] [\fB--complete\fP \fIINTEGER\fP]
  [\fB-h\fP|\fB--help\fP]


.fam T
.fi
.fam T
.fi
.SH DESCRIPTION

\fBose-upgrade\fP is a tool for upgrading an OpenShift Enterprise host
when that upgrade requires coordination and/or changes more substantial
than a simple yum update. 
.SH OPTIONS

.TP
.B
\fB-h\fP|\fB--help\fP
Show a usage summary and exit.
.TP
.B
\fB-q\fP|\fB--quiet\fP
Only display warnings and failures. The default output can be rather verbose.
All output is still logged to /var/log/openshift/upgrade.log even with this option.
.TP
.B
\fB-s\fP|\fB--skip\fP
Mark upgrade \fBstep\fP(s) complete rather than running. Used mainly for
testing or when a problem with a step has been resolved manually.
.TP
.B
\fB-d\fP|\fB--debug\fP
Enable extra debugging output.
.TP
.B
\fB--complete\fP \fIINTEGER\fP
Mark given upgrade number as complete. This clears all upgrade state
in preparation for the next upgrade. Upgrades are numbered beginning with 1,
which was the upgrade of OpenShift Enterprise 1.1 to 1.2.
.SH USAGE

An upgrade consists of one or more steps, each of which often consists of one or more
scripts, all of which must run sequentially. The state of the last completed or current
upgrade is stored in the state file /etc/openshift/upgrade/state.yaml, indicating completed
steps and scripts for the current upgrade. The upgrade log is stored in
/var/log/openshift/upgrade.log.
.PP
Consult the OpenShift Enterprise release notes for step details for specific releases.
.IP \(bu 3
With no arguments, \fBose-upgrade\fP displays status as if "status" had been requested.
.IP \(bu 3
With "status", \fBose-upgrade\fP displays the current upgrade number, the known steps, and the next step.
If no upgrade is pending or in progress, the previous upgrade number is displayed.
.IP \(bu 3
With "all", \fBose-upgrade\fP will run all available steps for this host. Note that part of the upgrade
is likely to require a manual update of \fBose-upgrade\fP itself, after which more steps may become available.
If any step fails, \fBose-upgrade\fP exits at that time.
.IP \(bu 3
Given one or more steps, \fBose-upgrade\fP will run the given steps in order. A step must succeed or be
skipped before the next step can be run.
.PP
Normally \fBose-upgrade\fP exits with exit code 0 for success. A non-zero exit code indicates
a failure to complete a step.
.SH FAILURE

\fBose-upgrade\fP is designed to enable retrying in the event a failure is detected. Nearly all
of the upgrade logic is implemented with scripts that perform a specific update and check
for success; usually these can safely run again until they succeed. Examine the upgrade.log to
determine what failed and how to resolve it (for
example, if a filesystem runs out of space, clear some space or expand the filesystem).
Then run \fBose-upgrade\fP with the failed step again; it will continue running the step/script that
failed, without re-running any that succeeded.
.SH WARNINGS

Prior to an upgrade, it is a good idea to execute oo-admin-chk on a broker and oo-diagnostics
on every deployed host. Address any existing problems prior to using \fBose-upgrade\fP.
.PP
An upgrade requires an outage and generally makes irreversible changes. Read the release notes
to understand what an upgrade entails, and practice upgrading a test deployment if possible.
Ensure that your entire deployment is adequately backed up and can be recovered in the event
of an unexpected failure during an upgrade.
.SH FILES

/var/log/openshift/upgrade.log - a complete log of the host upgrade output for troubleshooting purposes.
.PP
/etc/openshift/upgrade/state.yaml - a YAML file that records the status of the current upgrade,
including steps and scripts that completed or failed.
.SH SEE ALSO

\fBoo-admin-chk\fP(8), \fBoo-accept-broker\fP(8), \fBoo-accept-systems\fP(8),
\fBoo-accept-node\fP(8), \fBoo-diagnostics\fP(8)
.SH AUTHOR
Luke Meyer <lmeyer@redhat.com> - man page written for OpenShift
